<div class="profile-container" *ngIf="!loading">
  <div class="profile-header">
    <mat-card class="profile-card">
      <mat-card-header>
        <div mat-card-avatar class="profile-avatar">
          <img [src]="getProfileImageUrl()" [alt]="getDisplayName()" class="avatar-image">
        </div>
        <mat-card-title>{{ getDisplayName() }}</mat-card-title>
        <mat-card-subtitle>{{ getEmail() }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="profile-stats">
          <div class="stat-item">
            <mat-icon>person</mat-icon>
            <span>{{ userRoles.length }} <span i18n="@@profile.stats.roles">{{ userRoles.length !== 1 ? 'Roles' : 'Role' }}</span></span>
          </div>
          <div class="stat-item">
            <mat-icon>security</mat-icon>
            <span>{{ userPermissions.length }} <span i18n="@@profile.stats.permissions">{{ userPermissions.length !== 1 ? 'Permissions' : 'Permission' }}</span></span>
          </div>
          <div class="stat-item">
            <mat-icon>verified</mat-icon>
            <span [class.verified]="isEmailVerified" [class.unverified]="!isEmailVerified">
              <span *ngIf="isEmailVerified" i18n="@@profile.stats.verified">Verified</span>
              <span *ngIf="!isEmailVerified" i18n="@@profile.stats.unverified">Unverified</span>
            </span>
          </div>
        </div>
        
        <div class="account-info">
          <div class="info-item">
            <mat-icon>calendar_today</mat-icon>
            <span i18n="@@profile.stats.memberSince">Member since: {{ getAccountCreationDate() }}</span>
          </div>
          <div class="info-item">
            <mat-icon>login</mat-icon>
            <span i18n="@@profile.stats.lastSignIn">Last sign in: {{ getLastSignInDate() }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="profile-content">
    <mat-tab-group>
      <!-- Profile Information Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.profileInfo">Profile Information</span>
        </ng-template>
        <div class="tab-content">
          <app-profile-information [currentUser]="currentUser"></app-profile-information>
        </div>
      </mat-tab>

      <!-- Security Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.security">Security</span>
        </ng-template>
        <div class="tab-content">
          <app-security-settings [currentUser]="currentUser" [firebaseUser]="firebaseUser"></app-security-settings>
        </div>
      </mat-tab>


      <!-- API Keys Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>vpn_key</mat-icon>
          <span i18n="@@profile.tabs.apiKeys">API Keys</span>
        </ng-template>
        <div class="tab-content">
          <app-api-keys-management></app-api-keys-management>
        </div>
      </mat-tab>

      <!-- Account Management Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.accountManagement">Account Management</span>
        </ng-template>
        <div class="tab-content">
          <app-account-management [currentUser]="currentUser" [firebaseUser]="firebaseUser"></app-account-management>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p i18n="@@profile.loading">Loading profile...</p>
</div>
