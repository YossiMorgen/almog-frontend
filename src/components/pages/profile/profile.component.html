<div class="profile-container" *ngIf="!loading">
  <div class="profile-header">
    <mat-card class="profile-card">
      <mat-card-header>
        <div mat-card-avatar class="profile-avatar">
          <img [src]="getProfileImageUrl()" [alt]="getDisplayName()" class="avatar-image">
        </div>
        <mat-card-title>{{ getDisplayName() }}</mat-card-title>
        <mat-card-subtitle>{{ getEmail() }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="profile-stats">
          <div class="stat-item">
            <mat-icon>person</mat-icon>
            <span>{{ userRoles.length }} <span i18n="@@profile.stats.roles">{{ userRoles.length !== 1 ? 'Roles' : 'Role' }}</span></span>
          </div>
          <div class="stat-item">
            <mat-icon>security</mat-icon>
            <span>{{ userPermissions.length }} <span i18n="@@profile.stats.permissions">{{ userPermissions.length !== 1 ? 'Permissions' : 'Permission' }}</span></span>
          </div>
          <div class="stat-item">
            <mat-icon>verified</mat-icon>
            <span [class.verified]="isEmailVerified" [class.unverified]="!isEmailVerified">
              <span *ngIf="isEmailVerified" i18n="@@profile.stats.verified">Verified</span>
              <span *ngIf="!isEmailVerified" i18n="@@profile.stats.unverified">Unverified</span>
            </span>
          </div>
        </div>
        
        <div class="account-info">
          <div class="info-item">
            <mat-icon>calendar_today</mat-icon>
            <span i18n="@@profile.stats.memberSince">Member since: {{ getAccountCreationDate() }}</span>
          </div>
          <div class="info-item">
            <mat-icon>login</mat-icon>
            <span i18n="@@profile.stats.lastSignIn">Last sign in: {{ getLastSignInDate() }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="profile-content">
    <mat-tab-group>
      <!-- Profile Information Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.profileInfo">Profile Information</span>
        </ng-template>
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <mat-icon>person</mat-icon>
                <span i18n="@@profile.personalInfo.title">Personal Information</span>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label i18n="@@profile.personalInfo.fullName">Full Name</mat-label>
                  <input matInput formControlName="name" placeholder="Enter your full name" i18n-placeholder="@@profile.personalInfo.fullNamePlaceholder">
                  <mat-error *ngIf="profileForm.get('name')?.hasError('required')" i18n="@@profile.personalInfo.nameRequired">
                    Name is required
                  </mat-error>
                  <mat-error *ngIf="profileForm.get('name')?.hasError('maxlength')" i18n="@@profile.personalInfo.nameMaxLength">
                    Name must be less than 200 characters
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                  <mat-label i18n="@@profile.personalInfo.email">Email</mat-label>
                  <input matInput formControlName="email" placeholder="Enter your email" i18n-placeholder="@@profile.personalInfo.emailPlaceholder" readonly>
                  <mat-icon matSuffix>lock</mat-icon>
                  <mat-hint i18n="@@profile.personalInfo.emailHint">Email cannot be changed here. Use the Security tab to update email.</mat-hint>
                </mat-form-field>

                <div class="form-actions">
                  <button mat-raised-button color="primary" type="submit" 
                          [disabled]="profileForm.invalid || updating">
                    <mat-icon *ngIf="updating">hourglass_empty</mat-icon>
                    <mat-icon *ngIf="!updating">save</mat-icon>
                    <span *ngIf="updating" i18n="@@profile.personalInfo.updating">Updating...</span>
                    <span *ngIf="!updating" i18n="@@profile.personalInfo.updateProfile">Update Profile</span>
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>

          <!-- Roles and Permissions -->
          <mat-card *ngIf="userRoles.length > 0 || userPermissions.length > 0">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>admin_panel_settings</mat-icon>
                <span i18n="@@profile.rolesPermissions.title">Roles & Permissions</span>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="roles-section" *ngIf="userRoles.length > 0">
                <h4 i18n="@@profile.rolesPermissions.roles">Roles</h4>
                <div class="chips-container">
                  <mat-chip-set>
                    <mat-chip *ngFor="let role of userRoles" color="primary" selected>
                      <mat-icon matChipAvatar>badge</mat-icon>
                      {{ role }}
                    </mat-chip>
                  </mat-chip-set>
                </div>
              </div>

              <div class="permissions-section" *ngIf="userPermissions.length > 0">
                <h4 i18n="@@profile.rolesPermissions.permissions">Permissions</h4>
                <div class="chips-container">
                  <mat-chip-set>
                    <mat-chip *ngFor="let permission of userPermissions" color="accent" selected>
                      <mat-icon matChipAvatar>security</mat-icon>
                      {{ permission }}
                    </mat-chip>
                  </mat-chip-set>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Security Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.security">Security</span>
        </ng-template>
        <div class="tab-content">
          <!-- Email Verification -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <mat-icon>email</mat-icon>
                <span i18n="@@profile.security.emailVerification.title">Email Verification</span>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="verification-status">
                <mat-icon [class.verified-icon]="isEmailVerified" [class.unverified-icon]="!isEmailVerified">
                  {{ isEmailVerified ? 'verified' : 'warning' }}
                </mat-icon>
                <span [class.verified]="isEmailVerified" [class.unverified]="!isEmailVerified">
                  <span *ngIf="isEmailVerified" i18n="@@profile.security.emailVerification.verified">Email is verified</span>
                  <span *ngIf="!isEmailVerified" i18n="@@profile.security.emailVerification.unverified">Email is not verified</span>
                </span>
              </div>
              
              <p *ngIf="!isEmailVerified" class="verification-message" i18n="@@profile.security.emailVerification.message">
                Please verify your email address to secure your account and access all features.
              </p>
              
              <div class="form-actions">
                <button mat-raised-button color="primary" 
                        (click)="sendEmailVerification()" 
                        [disabled]="isEmailVerified">
                  <mat-icon>send</mat-icon>
                  <span *ngIf="isEmailVerified" i18n="@@profile.security.emailVerification.emailVerified">Email Verified</span>
                  <span *ngIf="!isEmailVerified" i18n="@@profile.security.emailVerification.sendVerification">Send Verification Email</span>
                </button>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Change Password -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <mat-icon>lock</mat-icon>
                <span i18n="@@profile.security.googleSecurity.title">Google Account Security</span>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="google-security-info">
                <mat-icon color="primary">security</mat-icon>
                <div class="security-content">
                  <h4 i18n="@@profile.security.googleSecurity.subtitle">Google Account Security</h4>
                  <p i18n="@@profile.security.googleSecurity.description">Your account is secured through Google OAuth. To change your password or manage security settings, please visit your Google Account settings.</p>
                  <a href="https://myaccount.google.com/security" target="_blank" mat-raised-button color="primary">
                    <mat-icon>open_in_new</mat-icon>
                    <span i18n="@@profile.security.googleSecurity.manageButton">Manage Google Security</span>
                  </a>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Settings Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.settings.tab">Settings</span>
        </ng-template>
        <div class="tab-content">
          <!-- Language Settings -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <div class="flex items-center">
                  <mat-icon>language</mat-icon>
                  <span i18n="@@profile.settings.language.title">Language Settings</span>
                </div>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <form [formGroup]="languageForm" (ngSubmit)="updateLanguage()">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label i18n="@@profile.settings.language.label">Preferred Language</mat-label>
                  <mat-select formControlName="language">
                    <mat-option value="en">
                      <span class="language-option">
                        <span class="flag">🇺🇸</span>
                        <span i18n="@@profile.settings.language.english">English</span>
                      </span>
                    </mat-option>
                    <mat-option value="he">
                      <span class="language-option">
                        <span class="flag">🇮🇱</span>
                        <span i18n="@@profile.settings.language.hebrew">עברית</span>
                      </span>
                    </mat-option>
                  </mat-select>
                  <mat-hint i18n="@@profile.settings.language.hint">Choose your preferred language for the interface</mat-hint>
                </mat-form-field>

                <div class="form-actions">
                  <button mat-raised-button color="primary" type="submit" 
                          [disabled]="languageForm.invalid || updating">
                    <mat-icon *ngIf="updating">hourglass_empty</mat-icon>
                    <mat-icon *ngIf="!updating">save</mat-icon>
                    <span *ngIf="updating" i18n="@@profile.settings.language.updating">Updating...</span>
                    <span *ngIf="!updating" i18n="@@profile.settings.language.update">Update Language</span>
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Account Management Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <span i18n="@@profile.tabs.accountManagement">Account Management</span>
        </ng-template>
        <div class="tab-content">
          <!-- Account Information -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <mat-icon>info</mat-icon>
                <span i18n="@@profile.accountManagement.title">Account Information</span>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="account-details">
                <div class="detail-item">
                  <mat-icon>person</mat-icon>
                  <div class="detail-content">
                    <span class="detail-label" i18n="@@profile.accountManagement.displayName">Display Name</span>
                    <span class="detail-value">{{ getDisplayName() }}</span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <mat-icon>email</mat-icon>
                  <div class="detail-content">
                    <span class="detail-label" i18n="@@profile.accountManagement.emailAddress">Email Address</span>
                    <span class="detail-value">{{ getEmail() }}</span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <mat-icon>calendar_today</mat-icon>
                  <div class="detail-content">
                    <span class="detail-label" i18n="@@profile.accountManagement.accountCreated">Account Created</span>
                    <span class="detail-value">{{ getAccountCreationDate() }}</span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <mat-icon>login</mat-icon>
                  <div class="detail-content">
                    <span class="detail-label" i18n="@@profile.accountManagement.lastSignIn">Last Sign In</span>
                    <span class="detail-value">{{ getLastSignInDate() }}</span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <mat-icon>verified</mat-icon>
                  <div class="detail-content">
                    <span class="detail-label" i18n="@@profile.accountManagement.emailStatus">Email Status</span>
                    <span class="detail-value" [class.verified]="isEmailVerified" [class.unverified]="!isEmailVerified">
                      <span *ngIf="isEmailVerified" i18n="@@profile.accountManagement.verified">Verified</span>
                      <span *ngIf="!isEmailVerified" i18n="@@profile.accountManagement.unverified">Unverified</span>
                    </span>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p i18n="@@profile.loading">Loading profile...</p>
</div>
