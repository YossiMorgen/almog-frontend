  <div class="page-header">
    <h1 class="page-title">{{ studentId == null ? 'Add New Student' : 'Edit Student' }}</h1>
    <div class="header-actions">
      <button mat-button (click)="onCancel()">
        <mat-icon>arrow_back</mat-icon>
        Back to Students
      </button>
    </div>
  </div>

  <mat-card>
    <mat-card-content>
      <form [formGroup]="studentForm" (ngSubmit)="submitForm()">
        <div *ngIf="loading" class="loading-container">
          <mat-spinner></mat-spinner>
          <p>Loading...</p>
        </div>

        <div *ngIf="error" class="error-container">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ error }}</p>
        </div>

        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="first_name" placeholder="Enter first name">
            <mat-error *ngIf="studentForm.get('first_name')?.hasError('required')">
              First name is required
            </mat-error>
            <mat-error *ngIf="studentForm.get('first_name')?.hasError('minlength')">
              First name must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="last_name" placeholder="Enter last name">
            <mat-error *ngIf="studentForm.get('last_name')?.hasError('required')">
              Last name is required
            </mat-error>
            <mat-error *ngIf="studentForm.get('last_name')?.hasError('minlength')">
              Last name must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Student Code</mat-label>
            <input matInput formControlName="student_code" placeholder="Enter student code">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="birthPicker" formControlName="date_of_birth" placeholder="Select date of birth">
            <mat-datepicker-toggle matSuffix [for]="birthPicker"></mat-datepicker-toggle>
            <mat-datepicker #birthPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Gender</mat-label>
            <mat-select formControlName="gender">
              <mat-option *ngFor="let option of genderOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" placeholder="Enter email">
            <mat-error *ngIf="studentForm.get('email')?.hasError('email')">
              Please enter a valid email
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone</mat-label>
            <input matInput type="tel" formControlName="phone" placeholder="Enter phone number">
          </mat-form-field>
        </div>

        <div class="form-grid">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Address</mat-label>
            <input matInput formControlName="address" placeholder="Enter address">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" placeholder="Enter city">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Postal Code</mat-label>
            <input matInput formControlName="postal_code" placeholder="Enter postal code">
          </mat-form-field>
        </div>

        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian Name</mat-label>
            <input matInput formControlName="parent_name" placeholder="Enter parent/guardian name">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian Email</mat-label>
            <input matInput type="email" formControlName="parent_email" placeholder="Enter parent/guardian email">
            <mat-error *ngIf="studentForm.get('parent_email')?.hasError('email')">
              Please enter a valid email
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian Phone</mat-label>
            <input matInput type="tel" formControlName="parent_phone" placeholder="Enter parent/guardian phone">
          </mat-form-field>
        </div>

        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Emergency Contact Name</mat-label>
            <input matInput formControlName="emergency_contact_name" placeholder="Enter emergency contact name">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Emergency Contact Phone</mat-label>
            <input matInput type="tel" formControlName="emergency_contact_phone" placeholder="Enter emergency contact phone">
          </mat-form-field>
        </div>

        <div class="form-grid">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Medical Notes</mat-label>
            <textarea matInput formControlName="medical_notes" placeholder="Enter medical notes" rows="3"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea matInput formControlName="notes" placeholder="Enter additional notes about the student" rows="3"></textarea>
          </mat-form-field>

          <div class="checkbox-container">
            <mat-checkbox formControlName="is_active">
              Active student
            </mat-checkbox>
          </div>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="onCancel()">
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            {{ loading ? 'Saving...' : (studentId ? 'Update Student' : 'Create Student') }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
